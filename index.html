<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

<title>Tetris Vilma</title>

<style>
  body{
    margin:0;
    background:#111;
    color:white;
    font-family:sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    touch-action:manipulation;
    user-select:none;
  }
  
  h2{
    margin:10px;
  }
  
  .container{
    display:flex;
    gap:15px;
    align-items:flex-start;
  }
  
  canvas{
    background:#000;
    border-radius:10px;
  }
  
  .info{
    display:flex;
    flex-direction:column;
    gap:20px;
  }
  
  .score{
    background:#222;
    padding:10px;
    border-radius:10px;
    text-align:center;
  }
  
  .controls{
    margin-top:15px;
    display:grid;
    grid-template-columns:repeat(2,172px);
    grid-gap:10px;
    justify-content:flex-start;
  }
  
  button{
    height:60px;
    font-size:22px;
    border:none;
    border-radius:12px;
    background:#333;
    color:white;
  }
  
  button:active{
    background:#666;
  }
</style>
</head>

<body>
  <br>
  <div class="container">
    <canvas id="game" width="240" height="480"></canvas>
    <div class="info">
      <div class="score">
        Pontua√ß√£o
        <h3 id="score">0</h3>
      </div>
      
      <div class="score">
        N√≠vel
        <h3 id="level">0</h3>
      </div>

      <div class="score">
        
        <h1 id="humor">üòç</h1>
      </div>
      
      <div class="score">
        Pr√≥xima
        <br>
        <canvas id="next" width="80" height="80"></canvas>
      </div>
    </div>
  </div>
  
  <div class="controls">
    <button id="left">‚¨ÖÔ∏è</button>
    <button id="right">‚û°Ô∏è</button>
    <button id="down" class="down">‚¨áÔ∏è</button>
    <button id="rotate" class="rotate">üîÑ</button>
    <button id="retry" class="retry">RECOME√áAR</button>
    <button id="pause" class="pause">PAUSAR</button>
  </div>


<script>

// ===== CONFIG =====

const COLS=10;
const ROWS=20;
const SIZE=24;

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

const nextCanvas=document.getElementById("next");
const nextCtx=nextCanvas.getContext("2d");


// ===== PE√áAS =====

const SHAPES=[
[[1]], //.
  
[[1,1,1,1]], // I

[[1,1],[1,1]], // O

[[0,1,0],[1,1,1]], // T

[[1,0,0],[1,1,1]], // J

[[0,0,1],[1,1,1]], // L

[[1,1,0],[0,1,1]], // S

[[0,1,1],[1,1,0]] // Z

];

const COLORS=[
"#888a8a",
"#00ffff",
"#ffff00",
"#bb00ff",
"#0044ff",
"#ff8800",
"#00ff88",
"#ff0044"
];


// ===== TABULEIRO =====
let board=Array.from({length:ROWS},()=>Array(COLS).fill(0));


// ===== PE√áA =====
let piece=null;
let nextPiece=randomPiece();

//===== PONTUA√á√ÉO =====
let score=0;

function recomecar()
{
  if (confirm("Deseja recome√ßar?"))
  {
    board=Array.from({length:ROWS},()=>Array(COLS).fill(0));
    level=0;
    document.getElementById("level").innerText=level;
    score=0;
    document.getElementById("score").innerText=score;
  }
}
  
// ===== SORTEAR PE√áA =====
function randomPiece()
{
  let id=Math.floor(Math.random()*SHAPES.length);
  return{shape:SHAPES[id], color:COLORS[id],x:3,y:0};
}


// ===== SOLTAR PE√áA =====
function spawn()
{
  piece=nextPiece;
  piece.x=3;
  piece.y=0;
  nextPiece=randomPiece();
  drawNext();
  
  if(collide(piece))
  {
    alert("Game Over");
    recomecar();
  }
}

// ===== FUN√á√ïES PARA EMOJI =====
function calcularPerigo()
{
  let alturaMax=0;
  let buracos=0;
  let topoOcupado=0;
  
  // ===== altura =====
  for(let y=0;y<ROWS;y++)
  {
    let ocupada= board[y].some(c=>c);
    if(ocupada)
    {
      alturaMax=ROWS-y;
      break;
    }
  }
   
  // ===== topo =====
  for(let y=0;y<5;y++)
  {
    if(board[y].some(c=>c))
    topoOcupado++;
  }
  
  // ===== buracos =====
  for(let x=0;x<COLS;x++)
  {
    let encontrouBloco=false;
    for(let y=0;y<ROWS;y++)
    {
      if(board[y][x])
      {
        encontrouBloco=true;
      }
      else if(encontrouBloco)
      {
        buracos++;
      }
    }
  }
  
  // ===== pesos =====
  let perigo=0;
  perigo+=alturaMax*3;
  perigo+=topoOcupado*12;
  perigo+=buracos*0.7;
    
  // limitar
  perigo=Math.min(100,Math.floor(perigo));
  
  return perigo;
}

function humorEmoji(valor)
{
  if(valor<=10) return "üòç";
  if(valor<=25) return "üòä";
  if(valor<=40) return "üòÉ";
  if(valor<=55) return "üòÖ";
  if(valor<=70) return "ü•≤";
  if(valor<=85) return "üò¢";
  return "üò≠";
}

function mostrarHumor()
{
  let perigo = calcularPerigo();
  let emoji = humorEmoji(perigo);
  document.getElementById("humor").innerText = emoji;
}
  
// ===== COLIS√ÉO =====
function collide(p)
{
  return p.shape.some((row,dy)=> row.some((value,dx)=>{
    if(!value)
      return false;
    
    let x=p.x+dx;
    let y=p.y+dy;
    return(x<0 ||x>=COLS ||y>=ROWS ||(board[y] && board[y][x]));
  }));
}


  
// ===== QUANDO FIXA PE√áA =====
function merge()
{
  piece.shape.forEach((row,dy)=>{
    row.forEach((v,dx)=>{
      if(v){
        board[piece.y+dy][piece.x+dx]=piece.color;
      }
    });
  });
  clearLines();
  spawn();
  mostrarHumor();
}


// ===== LIMPAR LINHAS =====
function clearLines()
{
  let lines=0;
  board=board.filter(row=>{
    if(row.every(v=>v)){
      lines++;
      return false;
    }
    return true;
  });
  
  while(board.length<ROWS){
    board.unshift(Array(COLS).fill(0));
  }
  
  if(lines)
  {
    score+=lines*100;
    document.getElementById("score").innerText=score;
    
    // LEVEL (AUMENTA UM A CADA 500 PONTOS E CHEGA NO M√ÅXIMO A 20)
    level=Math.min(20,Math.floor(score/500));
    document.getElementById("level").innerText=level;
    
    // VELOCIDADE (IMPACTADA PELO LEVEL)
    dropInterval = 700-(level*30);
    if(dropInterval<80)
      dropInterval=80; //N√ÉO DEIXA SER INFERIOR A 80, SE N√ÉO FICA IMPOSS√çVEL DE JOGAR
  }
}


// ===== ROTACIONAR PE√áAS =====
function rotate()
{
  let rotated=piece.shape[0].map((_,i)=> piece.shape.map(r=>r[i]).reverse());
  let backup=piece.shape;
  piece.shape=rotated;
  
  if(collide(piece)){
    piece.shape=backup;
  }
}


// ===== DESENHAR JOGO =====
function drawCell(x,y,color)
{
  ctx.fillStyle=color;
  ctx.fillRect(x*SIZE,y*SIZE,SIZE-1,SIZE-1);
}

function draw()
{
  ctx.clearRect(0,0,canvas.width,canvas.height);
  
  // board
  board.forEach((row,y)=>{
    row.forEach((color,x)=>{
      if(color){
        drawCell(x,y,color);
      }
    });
  });
  
  // pe√ßa
  if(piece)
  {
    piece.shape.forEach((row,dy)=>{
      row.forEach((v,dx)=>{
        if(v){
          drawCell(piece.x+dx,piece.y+dy,piece.color);
        }
      });
    });
  }
}


// ===== PR√âVIA DA R√ìXIMA PE√áA=====
function drawNext()
{
  nextCtx.clearRect(0,0,nextCanvas.width,nextCanvas.height);
  const block=16;
  const gap=2;
  let shape=nextPiece.shape;
  let rows=shape.length;
  let cols=shape[0].length;
  
  // tamanho real da pe√ßa
  let pieceWidth = cols*(block+gap);
  let pieceHeight = rows*(block+gap);
  
  // centralizar
  let offsetX = (nextCanvas.width-pieceWidth)/2;
  let offsetY = (nextCanvas.height-pieceHeight)/2;

  shape.forEach((row,y)=>{
    row.forEach((v,x)=>{
      if(v){
        nextCtx.fillStyle= nextPiece.color;
        nextCtx.fillRect(offsetX + x*(block+gap),offsetY + y*(block+gap),block,block);
      }
    });
  });
}


// ===== MOVIMENTO =====
function move(dx)
{
  piece.x+=dx;
  if(collide(piece))
  {
    piece.x-=dx;
  }
}

//QUEDA DA PE√áA
function drop()
{
  piece.y++;
  if(collide(piece))
  {
    piece.y--;
    merge();
  }
}


// ===== LOOP =====
let dropCounter=0;
let dropInterval=700;
let last=0;
let level=0;
let pausado = false;

function update(time=0)
{
  let delta = time - last;
  last = time;

  // se pausado n√£o cai pe√ßa
  if(!pausado)
  {
    dropCounter += delta;
    if(dropCounter > dropInterval)
    {
      drop();
      dropCounter = 0;
    }
  }
  draw();

  // desenha aviso pausa
  if(pausado)
  {
    ctx.fillStyle="rgba(0,0,0,0.6)";
    ctx.fillRect(0,canvas.height/2 - 40,canvas.width,80);
    ctx.fillStyle="white";
    ctx.font="bold 28px sans-serif";
    ctx.textAlign="center";
    ctx.fillText("‚è∏ PAUSADO",canvas.width/2,canvas.height/2 +10);
  }
  requestAnimationFrame(update);
}

// ===== BOT√ïES =====
document.getElementById("left").onclick = ()=>{ if(!pausado) move(-1); };
document.getElementById("right").onclick = ()=>{ if(!pausado) move(1); };
document.getElementById("rotate").onclick = ()=>{ if(!pausado) rotate(); };
document.getElementById("down").onclick = ()=>{ if(!pausado) drop(); };
document.getElementById("retry").onclick= ()=>{ if(!pausado) recomecar(); };
document.getElementById("pause").onclick = ()=> {
  pausado = !pausado;
  const btn = document.getElementById("pause");
  btn.innerText = pausado ? "DESPAUSAR" : "PAUSAR";
};

// ===== PC OPCIONAL =====
document.addEventListener("keydown", e=>{
  if(pausado) return;
  if(e.key==="ArrowLeft") move(-1);
  if(e.key==="ArrowRight") move(1);
  if(e.key==="ArrowUp") rotate();
  if(e.key==="ArrowDown") drop();
});

// ===== START =====
spawn();
update();
</script>
  <h5>Desenvolvido com amor e carinho para Vov√≥ Vilma.</h5>
</body>
</html>
